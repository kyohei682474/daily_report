# 2024/11/21の日報
## 取り組んだ課題一覧
* タイピング練習
* Ruby on Rails5速習実践ガイドをやる
## わかったこと
* time.zoneの値の制御の仕方はアプリケーション起動時に適切な値を入れる。Railsアプリケーション内でTime.zoneを変更する
  *  起動時に適切な値を入れるにはconfig/application.rbでconfig.time_zoneに設定する
  *  リクエストごとに異なるタイムゾーンで時刻を入出力を行いたい場合、フィルタなどでTime.zoneの値を切り替える。
  *  1つのリクエストに対して複数のタイムゾーンを表示したい場合はActiveSupport::TimeWithZoneオブジェクトのin_time_zoneメソッドを使用する
*  現在の時間を得たい時はTime.zone.nowを使用するが、Time.currentやData.currentを使用しても同じように現在の時間を表示することができる。
  *  Date.todayは時間までは表示されない。
*  エラーの表示は開発環境用とテスト環境用と本番環境用で分かれている。
  * 開発環境で本番のエラー画面を表示して欲しい場合はconfig/environments/development.rbのconsider_all_requests_localをfalseにする。
  * エラー画面のファイルはpublic/500.htmlなどが対応してHTTPステータスコードごとに用意する仕組み
* ステータスコード404ルーティングで行き先となるActionが見つからない。モデルで指定したidのレコードが見つからないなど、ユーザーの求めるリソースが提供できないことにつながるような例外
* ステータスコード500はシステムエラー全般
* rescue_fromというメソッドを利用することで特定のアクションの特定の例外について専用的な処理を行いたい場合や比較的手軽に動的エラー画面を出したい時にコントローラ内で利用する。
*  railsが提供しているloggerオブジェクトを通じて自らコントローラやモデルなどからエラーログを出力することができる。
  *  loggerオブジェクトのdebuメソッドを呼び出すことでログにタスクの情報をdebugレベルで出力する
  *  どのレベルのログまでを拾い上げるかを設定することができる。デフォルトでは開発者向けのdebugのログレベル、つまり全てのログレベルが出力される。
  *  ログレベルの設定はconfig/environments/development.rbにconfig,log_level = :warmを追記する。
*  セキュアな情報はログに出力をさせないようにマスクする必要がある。config/initializes/fillter_parameter_logging.rbのRails.application.config.filter_parametersに設定。
  *  Rails.application.config.filter_parameters　+= [:password]とすることでpasswordのパラメータ値はログ上で[FILTERED]になる。
*  ロガーの設定はconfig/environments配下の環境ごとに設定を行う。
  *  config.logger = Logger.new('log/development.log','daily')
  *  1日ごとにdevelopment.rbにログを取ることができる。
* セッションハイジャックとは攻撃者が利用者のsession IDを盗み取理、そのユーザーとしてログインすること。
  * cookieを盗まれることによってセッションハイジャックは起こってしまう。
  * 暗号化されていない無線接続を行うことにより容易にcookieが盗まれてしまう。
  * SSl接続を行うことにより防ぐことができる。config.force_ssl = trueと記述することによりSSL接続を強制的に行うことができる。
  * クロスサイトスクリプティング(XSS)の多くはcookieを盗むためのもの。
* クロスサイトスクリプトフォージェリーは認証完了していると思いこんているwebサイトに悪意のあるURLを仕込んでおくことにより、それをクリックした際にトークンIDのような情報を抜き取られる。
  * 対策としてはpost、getメソッドの使い分けをきちんと行う。
  * getは情報を単純に問い合わせ、取得するためのメソッド、postは投稿や削除など変更を行うメソッド。
* csrf_meta_tagsはクロスサイトリクエストフォージェリー対策で使用される
* インジェクションはWebアプリケーションに悪意のあるスクリプトパラメータやスクリプトを入力してそれが評価される時に権限で実行される攻撃
  * ユーザーがデータを入力する場所全てが攻撃の標的になる。フォームやリクエストパラメータであったりあらゆるデータの入り口。
  * インジェクションの具体例としてはXSS(クロスサイスクリプティング),SQLインジェクション,Rubyコードインジェクション、コマンドラインインジェクション
* クロスサイトスクリプティングはユーザーに表示するコンテンツに悪意のあるスクリプト(javascript)を仕掛け、そのコンテンツを表示したユーザーにスクリプトを実行させることにより任意の操作を行う攻撃
  * javascriptはユーザーの行動を読み取ったり、任意のアクションを実行させたりすることができる。cookieの読み書きも行える大きな権限があることからつねにセキュリティ上の危険に晒されている危険性がある。
  * javascriptの危険性を防ぐために同一オリジンポリシーという制限が設けられている。
  * オリジンとはプロトコル(URLのスキーム)、ホスト、ポートの組み合わせのこと
  * スキームはhttpのこと。URIの::よりも前の部分をさす。
  * スキームはURIの残りの部分の構造や解釈に影響を与える可能性がある。
* SQLの文字列にユーザーが直接値を埋め込むことでSQlインジェクションに対する脆弱性を作ってしまう恐れがある。
* あるオリジンのjavascriptから他のオリジンへはAjax通信が行えない仕組み。
* Railsではクエリメソッドに対してハッシュで条件を指定すると自動的に安全化のための処理を行なってくれる。
  * ハッシュで条件を指定するようにするのが良い。
  * user = User.where(name: params[:name])
  * ハッシュでは作成することができないSQLを作るためにクエリメソッドにSQLを直接書きたい場合、プレースホルダーを利用する。
  * user = User.where('name = ?',f params[:name])
  * プレースホルダーとは正式な値が入るまでに仮に入れておく値のこと。
* ホワイトリスト方式とは安全と判断されたリストのみ許可してそれ以外を対象外とする方式。
* exclude?は引数で渡された値が含まれているvalid?か確認するメソッド。
* valid?はエラーがあればfalse,エラーがなければtrue
* Invalid？はエラーがあればtrue,エラーがなければfalse
## 感じたこと
* Railsにはたくさんの機能があるがなるべく多くを使いこなせるようになりたいと感じた。
* セキュリティに関する犯罪はいけないことだが、その仕組みを理解することはアプリケーションを作成する際にも非常に役立つことが多い。
## 合計時間  
Today: 3.5h<br>
Total: 918.25h
